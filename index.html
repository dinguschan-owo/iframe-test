<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website 2</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body id="content">
    <script>
        const url = new URLSearchParams(window.location.search).get('url');
        const proxies = [
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://api.codetabs.com/v1/tmp/?quest=',
            'https://api.allorigins.win/raw?url='
        ];
        let proxyIndex = 0;

        async function fetchWithProxy() {
            if (proxyIndex >= proxies.length) {
                document.body.innerHTML = 'Error: Could not fetch the website content after multiple attempts.';
                return;
            }

            const proxy = proxies[proxyIndex];
            const fetchUrl = proxy + encodeURIComponent(url);

            try {
                const response = await fetch(fetchUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.text();

                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');

                // Handle CSS and JS extraction
                await handleExternalResources(doc);

                // Inject the modified HTML into the current document
                document.open();
                document.write(doc.documentElement.outerHTML);
                document.close();
            } catch (error) {
                console.error('Fetch error:', error);
                proxyIndex++;
                fetchWithProxy();
            }
        }

        async function handleExternalResources(doc) {
            const resources = [];

            // Extract and fetch external CSS
            const linkElements = Array.from(doc.querySelectorAll('link[rel="stylesheet"]'));
            linkElements.forEach(link => {
                const href = new URL(link.getAttribute('href'), url).href;
                resources.push({ href, type: 'css' });
            });

            // Extract and fetch external JS
            const scriptElements = Array.from(doc.querySelectorAll('script[src]'));
            scriptElements.forEach(script => {
                const src = new URL(script.getAttribute('src'), url).href;
                resources.push({ src, type: 'js' });
            });

            // Fetch and inject resources
            await Promise.all(resources.map(async resource => {
                try {
                    const content = await fetchResource(resource.type === 'css' ? resource.href : resource.src);
                    if (resource.type === 'css') {
                        const style = document.createElement('style');
                        style.textContent = content;
                        document.head.appendChild(style);
                    } else if (resource.type === 'js') {
                        const script = document.createElement('script');
                        script.textContent = content;
                        document.body.appendChild(script);
                    }
                } catch (error) {
                    console.error(`Failed to fetch ${resource.type} resource:`, resource, error);
                }
            }));
        }

        async function fetchResource(resourceUrl) {
            try {
                const proxyUrl = proxies[proxyIndex] + encodeURIComponent(resourceUrl);
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                return await response.text();
            } catch (error) {
                throw new Error('Failed to fetch resource: ' + resourceUrl);
            }
        }

        if (url) {
            fetchWithProxy();
        } else {
            document.body.innerText = 'No URL provided.';
        }
    </script>
</body>
</html>
