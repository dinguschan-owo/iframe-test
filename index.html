<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website 2</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body id="content">
    <script>
        const url = new URLSearchParams(window.location.search).get('url');
        const proxies = [
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://api.codetabs.com/v1/tmp/?quest=',
            'https://api.allorigins.win/raw?url='
        ];
        let proxyIndex = 0;

        async function fetchWithProxy() {
            if (proxyIndex >= proxies.length) {
                document.body.innerHTML = 'Error: Could not fetch the website content after multiple attempts.';
                return;
            }

            const proxy = proxies[proxyIndex];
            const fetchUrl = proxy + encodeURIComponent(url);

            try {
                const response = await fetch(fetchUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.text();

                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');

                // Handle CSS files (internal and external)
                const linkElements = Array.from(doc.querySelectorAll('link[rel="stylesheet"]'));
                const cssPromises = linkElements.map(async link => {
                    const href = new URL(link.getAttribute('href'), url).href;
                    const cssContent = await fetchResource(href);
                    const style = document.createElement('style');
                    style.textContent = cssContent;
                    link.parentNode.replaceChild(style, link);
                });

                // Handle JS files (internal and external)
                const scriptElements = Array.from(doc.querySelectorAll('script[src]'));
                const jsPromises = scriptElements.map(async script => {
                    const src = new URL(script.getAttribute('src'), url).href;
                    const jsContent = await fetchResource(src);
                    const newScript = document.createElement('script');
                    newScript.textContent = jsContent;
                    script.parentNode.replaceChild(newScript, script);
                });

                // Handle external resources like fonts
                const externalResourcesPromises = Array.from(doc.querySelectorAll('link[rel="stylesheet"], script[src], img[src], link[rel="icon"], link[rel="shortcut icon"]')).map(async resource => {
                    const resourceUrl = new URL(resource.getAttribute('href') || resource.getAttribute('src'), url).href;
                    const content = await fetchResource(resourceUrl);
                    if (resource.tagName.toLowerCase() === 'link' && resource.getAttribute('rel') === 'stylesheet') {
                        const style = document.createElement('style');
                        style.textContent = content;
                        resource.parentNode.replaceChild(style, resource);
                    } else if (resource.tagName.toLowerCase() === 'script') {
                        const newScript = document.createElement('script');
                        newScript.textContent = content;
                        resource.parentNode.replaceChild(newScript, resource);
                    } else if (resource.tagName.toLowerCase() === 'img') {
                        resource.setAttribute('src', resourceUrl);
                    } else if (resource.tagName.toLowerCase().includes('link')) {
                        resource.setAttribute('href', resourceUrl);
                    }
                });

                // Wait for all CSS, JS, and external resources to be fetched and injected
                await Promise.all([...cssPromises, ...jsPromises, ...externalResourcesPromises]);

                // Inject the modified HTML into the current document
                document.open();
                document.write(doc.documentElement.outerHTML);
                document.close();
            } catch (error) {
                console.error('Fetch error:', error);
                proxyIndex++;
                fetchWithProxy();
            }
        }

        async function fetchResource(resourceUrl) {
            try {
                const proxyUrl = proxies[proxyIndex] + encodeURIComponent(resourceUrl);
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                return await response.text();
            } catch (error) {
                throw new Error('Failed to fetch resource: ' + resourceUrl);
            }
        }

        if (url) {
            fetchWithProxy();
        } else {
            document.body.innerText = 'No URL provided.';
        }
    </script>
</body>
</html>
