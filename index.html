<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Render Page</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #content {
            width: 100%;
            height: 100vh;
            overflow: auto;
            padding: 0;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div id="content">Loading...</div>
    <script>
        async function fetchAndRender() {
            // Get the URL from the query parameter
            const urlParams = new URLSearchParams(window.location.search);
            const url = urlParams.get('url');
            if (!url) {
                document.getElementById('content').innerHTML = 'No URL specified.';
                return;
            }

            const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`;
            try {
                const response = await fetch(proxyUrl);
                if (response.ok) {
                    const html = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');

                    // Inject CSS
                    const cssLinks = doc.querySelectorAll('link[rel="stylesheet"]');
                    cssLinks.forEach(link => {
                        const newLink = document.createElement('link');
                        newLink.rel = 'stylesheet';
                        newLink.href = new URL(link.href, url).href;
                        document.head.appendChild(newLink);
                    });

                    // Inject JS
                    const jsScripts = doc.querySelectorAll('script[src]');
                    jsScripts.forEach(script => {
                        const newScript = document.createElement('script');
                        newScript.src = new URL(script.src, url).href;
                        newScript.onload = () => console.log(`Loaded script: ${newScript.src}`);
                        document.body.appendChild(newScript);
                    });

                    // Inject HTML content
                    const contentDiv = document.getElementById('content');
                    contentDiv.innerHTML = doc.body.innerHTML;

                    // Execute inline scripts
                    const inlineScripts = doc.querySelectorAll('script:not([src])');
                    inlineScripts.forEach(script => {
                        const newScript = document.createElement('script');
                        newScript.textContent = script.textContent;
                        document.body.appendChild(newScript);
                    });

                } else {
                    document.getElementById('content').innerHTML = 'Failed to load content.';
                }
            } catch (error) {
                document.getElementById('content').innerHTML = 'Error: ' + error.message;
            }
        }

        fetchAndRender();
    </script>
</body>
</html>
