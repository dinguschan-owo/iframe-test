<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site 2: Render Page</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: auto;
        }
    </style>
</head>
<body>
    <script>
        async function fetchExternalResource(url) {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Failed to fetch resource at ${url}`);
            }
            return response.text();
        }

        async function fetchAndReplaceContent(url) {
            try {
                const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`;
                const response = await fetch(proxyUrl);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                let htmlContent = await response.text();
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, 'text/html');
                
                // Replace external CSS links with inline styles
                const stylesheetLinks = doc.querySelectorAll('link[rel="stylesheet"]');
                for (const link of stylesheetLinks) {
                    const cssText = await fetchExternalResource(link.href.startsWith('http') ? link.href : new URL(link.href, url).href);
                    htmlContent = htmlContent.replace(link.outerHTML, `<style>${cssText}</style>`);
                }

                // Replace external JavaScript links with inline scripts
                const scriptLinks = doc.querySelectorAll('script[src]');
                for (const script of scriptLinks) {
                    const scriptText = await fetchExternalResource(script.src.startsWith('http') ? script.src : new URL(script.src, url).href);
                    htmlContent = htmlContent.replace(script.outerHTML, `<script>${scriptText}</script>`);
                }

                // Update the content of the page
                document.body.innerHTML = htmlContent;
                
            } catch (error) {
                console.error('Fetch operation failed:', error);
                document.body.innerHTML = `<h1>Failed to load content from ${url}</h1>`;
            }
        }

        function getParameterByName(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        const url = getParameterByName('url');
        if (url) {
            fetchAndReplaceContent(url);
        } else {
            document.body.innerHTML = '<h1>No URL provided</h1>';
        }
    </script>
</body>
</html>
